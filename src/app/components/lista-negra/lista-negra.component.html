<div class="header pb-6">
    <div class="container-fluid">
      <div class="header-body">
        <div class="row align-items-center py-4">
          <div class="col-lg-6 col-7">
            <h6 class="h2 text-white d-inline-block mb-0">Prosazón Comisiones</h6>
  
            <nav aria-label="breadcrumb" class="d-none d-md-inline-block ml-md-4">
              <ol class="breadcrumb breadcrumb-links breadcrumb-dark">
                <li class="breadcrumb-item">
                  <a> <i class="fas fa-home"> </i> </a>
                </li>
  
                <li aria-current="page" class="breadcrumb-item active">
                  Lista de asistencia
                </li>
              </ol>
            </nav>
          </div>
  
          <div class="col-lg-6 col-5 text-right">
            <!-- <a class="btn btn-neutral btn-sm">
              IMPORTAR ASISTENCIAS
            </a> -->
          </div>
        </div>
      </div>
    </div>
  </div>
  
    <div *ngIf="form" class="container-fluid mt--6">
    <form class="validation" novalidate>
    <div class="card">
    <div class="card-header">
    <div class="row align-items-center">
    <div class="col-8">
    <h3 class="mb-0">Sube el archivo</h3>
    </div>

    <div class="col-4 text-right">
    <a class="btn btn-sm btn-outline-danger" (click)="close()">
    <svg
    xmlns="http://www.w3.org/2000/svg"
    width="16"
    height="16"
    fill="currentColor"
    class="bi bi-x-lg"
    viewBox="0 0 16 16"
    >
    <path
    d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"
    />
    </svg>
    </a>
    </div>
    </div>
    </div>

    <div class="card-body">
    <div class="pl-lg-4">
    <div class="row">
    </div>

    <div class="row">
    <div class="col-lg-6">
      <div class="form-group">
        <label class="form-control-label" for="motivo"> Archivo </label>
        <div class="custom-file">
          <input type="file" class="custom-file-input" id="logo"
              (change)="fileChangeEvent($event,1)" (click)="clickHandleFile()">
          <label class="custom-file-label" for="logo">
              Buscar archivo...
          </label>
        </div>
        <br>
        <label class="form-control-label" *ngIf="rowsFound > -1">{{rowsFound}} registros encontrados </label>
      </div>
    </div>
    </div>
    </div> 
    <div class="text-right">
      <button
        class="btn btn-secondary"
        type="button"
        (click)="close()"
      >
        Cancelar
      </button>
      <button
        class="btn btn-primary"
        type="submit"
        [disabled]="guardarButtonDisabled" 
      >
        Guardar
      </button>
    </div>
    <hr class="my-4" />
    </div>
    </div>
    <br />
    <br />
    <br />
    </form>
    </div>
  
  <div class="container-fluid mt--6">
    <div class="row">
      <div class="col">
        <div class="card">
          <div class="card-header">
            <h3 class="mb-0">Lista de asistencia</h3>
            <p class="text-sm mb-0">Listado de asignaciones de empleados y su asistencia en la semana</p>
          </div>
  

          <div class="row" style="margin-left: 15px;">
            <div class="col-sm-12 col-md-12">
              <div class="row">
                <div class="col-11">
                  <div class="form-group">
                    <label class="form-control-label"> Empleado </label>
                    <ng-multiselect-dropdown
                    name="employee"
                    [placeholder]="'Selecciona empleados'"
                    [data]="employeeList"
                    formControlName="employee"
                    [disabled]="false"
                    [settings]="dropdownSettings"
                    (onSelect)="onItemSelect($event)"
                    (onDeSelect)="onItemDeSelect($event)">
                    </ng-multiselect-dropdown>
                    <!-- <select class="form-control form-control-sm" data-toggle="select"  style="margin-top: 18px;">
                      <option selected disabled>Selecciona</option>
                      <option
                      *ngFor="let employee of employeeList"
                      [ngValue]="employee.id"
                      >
                      {{ employee.fullName }}
                      </option>
                      <option value="T" selected>Todos</option>
                  </select> -->
                  </div>
                </div>
              </div>

              <div class="row">
                <div class="col-9">
                  <div class="form-group">
                    <label class="form-control-label"> Selecciona un periodo </label>
                    <div class="row">
                      <div class="col-3" style="margin-top: -13px;">
                        <label style="font-size: 12px;"> Selecciona el año </label>
                        <input type="number" min="1900" max="2099" step="1" class="form-control form-control-sm" [(ngModel)]="currentYearComission" (change)="setMonthPeriods()" />
                      </div>

                      <div class="col-3" style="margin-top: -13px;">
                        <label style="font-size: 12px;"> Selecciona el mes </label>
                        <select
                        class="form-control form-control-sm"
                        data-toggle="select"
                        id="select-estacion"
                        [(ngModel)]="currentMothComission"
                        (change)="setMonthPeriods()"
                        >
                        <option value="0">Enero</option>
                        <option value="1">Febrero</option>
                        <option value="2">Marzo</option>
                        <option value="3">Abril</option>
                        <option value="4">Mayo</option>
                        <option value="5">Junio</option>
                        <option value="6">Julio</option>
                        <option value="7">Agosto</option>
                        <option value="8">Septiembre</option>
                        <option value="9">Octubre</option>
                        <option value="10">Noviembre</option>
                        <option value="11">Diciembre</option>
                      </select>
                      </div>

                      <div class="col-5" style="margin-top: -13px;">
                        <label style="font-size: 12px;"> Selecciona el periodo </label>
                        <select
                        class="form-control form-control-sm"
                        data-toggle="select"
                        id="select-period"
                        [(ngModel)]="periodComission"
                        >
                        <option
                        *ngFor="let period of datePeriods"
                        [ngValue]="period.Id"
                        >
                        {{ period.Text }}
                        </option>
                      </select>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="col-3">
                  <div class="text-right" style="margin-right: 15px;">
                      <br>
                      <br>
                      <button
                      class="btn btn-sm btn-secondary"
                      type="button"
                      (click)="resetearRegistros()"
                      >
                      Limpiar filtros
                      </button>
                      <button
                      class="btn btn-sm btn-primary"
                      type="button"
                      (click)="setPeriodDays(); getAssignments();"
                      >
                      Buscar
                      </button>
                  </div>
              </div>

              </div>
            </div>
          </div>
            
          <div class="table-responsive">
            <table class="table align-items-center table-flush table-hover">
              <thead class="thead-light">
                <tr>
                  <th scope="col">Empleado</th>
                  <th scope="col">Cliente</th>
                  <th scope="col">Sucursal</th>
                  <th scope="col">Estatus</th>
                  <th scope="col">Ayuda Transporte</th>
                  <th scope="col" class="dia-col" *ngIf="periodControls.Lun == true">Lunes <br> {{periodControls.LunText}} </th>
                  <th scope="col" class="dia-col" *ngIf="periodControls.Mar == true">Martes <br> {{periodControls.MarText}} </th>
                  <th scope="col" class="dia-col" *ngIf="periodControls.Mie == true">Miercoles <br> {{periodControls.MieText}} </th>
                  <th scope="col" class="dia-col" *ngIf="periodControls.Jue == true">Jueves <br> {{periodControls.JueText}} </th>
                  <th scope="col" class="dia-col" *ngIf="periodControls.Vie == true">Viernes <br> {{periodControls.VieText}} </th>
                  <th scope="col" class="dia-col" *ngIf="periodControls.Sab == true">Sabado  <br> {{periodControls.SabText}} </th>
                  <th scope="col" class="dia-col" *ngIf="periodControls.Dom == true">Domingo <br> {{periodControls.DomText}} </th>
                </tr>
              </thead>
  
              <tbody class="list">
                <tr *ngFor="let registro of listaAsistencia; let i = index">
                  <td>{{ registro.empleado }}</td>
                  <td>{{ registro.cliente }}</td>
                  <td>{{ registro.sucursal }}</td>
                  <td>{{ registro.status }}</td>
                  <td>
                    <input [disabled] = "!enableEditing || registro.status == 'Confirmada'" type="text" class="form-control form-control-sm" pattern="[0-9]*[.,]?[0-9]*" inputmode="decimal" placeholder="" [(ngModel)]="registro.CommuteAmount" (keypress)="validarInput($event)">
                  </td>
                  <td class="dia-col" *ngIf="periodControls.Lun == true">  
                    <select [disabled] = "!enableEditing || registro.status == 'Confirmada'" class="form-control form-control-sm dia-col" data-toggle="select" [(ngModel)]="registro.Monday">
                      <option selected disabled></option>
                      <option
                      *ngFor="let tipoAsignacion of tiposAsignacionList"
                      [ngValue]="tipoAsignacion.code"
                      [title]="tipoAsignacion.name"
                      >
                      {{ tipoAsignacion.code }}
                      </option>
                    </select>
                    </td>
                    <td class="dia-col" *ngIf="periodControls.Mar == true">  
                      <select [disabled] = "!enableEditing || registro.status == 'Confirmada'" class="form-control form-control-sm dia-col" data-toggle="select" [(ngModel)]="registro.Tuesday">
                        <option selected disabled></option>
                        <option
                        *ngFor="let tipoAsignacion of tiposAsignacionList"
                        [ngValue]="tipoAsignacion.code"
                        [title]="tipoAsignacion.name"
                        >
                        {{ tipoAsignacion.code }}
                        </option>
                      </select>
                      </td>
                      <td class="dia-col" *ngIf="periodControls.Mie == true">  
                        <select [disabled] = "!enableEditing || registro.status == 'Confirmada'" class="form-control form-control-sm dia-col" data-toggle="select" [(ngModel)]="registro.Wednesday">
                          <option selected disabled></option>
                          <option
                          *ngFor="let tipoAsignacion of tiposAsignacionList"
                          [ngValue]="tipoAsignacion.code"
                          [title]="tipoAsignacion.name"
                          >
                          {{ tipoAsignacion.code }}
                          </option>
                        </select>
                      </td>
                      <td class="dia-col" *ngIf="periodControls.Jue == true">  
                        <select [disabled] = "!enableEditing || registro.status == 'Confirmada'" class="form-control form-control-sm dia-col" data-toggle="select" [(ngModel)]="registro.Thursday">
                          <option selected disabled></option>
                          <option
                          *ngFor="let tipoAsignacion of tiposAsignacionList"
                          [ngValue]="tipoAsignacion.code"
                          [title]="tipoAsignacion.name"
                          >
                          {{ tipoAsignacion.code }}
                          </option>
                        </select>
                      </td>
                      <td class="dia-col" *ngIf="periodControls.Vie == true">  
                        <select [disabled] = "!enableEditing || registro.status == 'Confirmada'" class="form-control form-control-sm dia-col" data-toggle="select" [(ngModel)]="registro.Friday">
                          <option selected disabled></option>
                          <option
                          *ngFor="let tipoAsignacion of tiposAsignacionList"
                          [ngValue]="tipoAsignacion.code"
                          [title]="tipoAsignacion.name"
                          >
                          {{ tipoAsignacion.code }}
                          </option>
                        </select>
                      </td>
                      <td class="dia-col" *ngIf="periodControls.Sab == true">  
                        <select [disabled] = "!enableEditing || registro.status == 'Confirmada'" class="form-control form-control-sm dia-col" data-toggle="select" [(ngModel)]="registro.Saturday">
                          <option selected disabled></option>
                          <option
                          *ngFor="let tipoAsignacion of tiposAsignacionList"
                          [ngValue]="tipoAsignacion.code"
                          [title]="tipoAsignacion.name"
                          >
                          {{ tipoAsignacion.code }}
                          </option>
                        </select>
                      </td>
                      <td class="dia-col" *ngIf="periodControls.Dom == true">  
                        <select [disabled] = "!enableEditing || registro.status == 'Confirmada'" class="form-control form-control-sm dia-col" data-toggle="select" [(ngModel)]="registro.Sunday">
                          <option selected disabled></option>
                          <option
                          *ngFor="let tipoAsignacion of tiposAsignacionList"
                          [ngValue]="tipoAsignacion.code"
                          [title]="tipoAsignacion.name"
                          >
                          {{ tipoAsignacion.code }}
                          </option>
                        </select>
                      </td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class=" modal-footer">
            <button class=" btn btn-primary btn-sm" type="button" (click)="setEnableEditing(true)" *ngIf="enableEditing == false">
              Habilitar para edición
            </button>

            <button class=" btn btn-secondary btn-sm" type="button" (click)="setEnableEditing(false)" style="float: left;" *ngIf="enableEditing == true">
              Cancelar
            </button>
           <!-- We pass confirm param to save function, to determine if the attendance list will be confirmed or not -->
            <button class=" btn btn-primary btn-sm" type="button" (click)="saveAttendanceSheet(false)" *ngIf="enableEditing == true">
              Guardar cambios
            </button>

            <button class=" btn btn-primary btn-sm" type="button" (click)="saveAttendanceSheet(true)" *ngIf="enableEditing == true">
              Guardar y confirmar
            </button>
          </div>

        </div>
      </div>
    </div>

    <ngx-spinner bdColor = "rgba(0, 0, 0, 0.8)" size = "medium" color = "#fff" type = "line-scale-party" [fullScreen] = "true"><p style="color: white" > Espere un monento... </p></ngx-spinner>
  </div>
  